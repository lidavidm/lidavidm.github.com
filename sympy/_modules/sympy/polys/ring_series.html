<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sympy.polys.ring_series &mdash; SymPy 1.0.1.dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://96.sympy-live-tests.appspot.com/static/live-core.css" type="text/css" />
    <link rel="stylesheet" href="http://96.sympy-live-tests.appspot.com/static/live-autocomplete.css" type="text/css" />
    <link rel="stylesheet" href="http://96.sympy-live-tests.appspot.com/static/live-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.1.dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://96.sympy-live-tests.appspot.com/static/utilities.js"></script>
    <script type="text/javascript" src="http://96.sympy-live-tests.appspot.com/static/external/classy.js"></script>
    <script type="text/javascript" src="http://96.sympy-live-tests.appspot.com/static/live-core.js"></script>
    <script type="text/javascript" src="http://96.sympy-live-tests.appspot.com/static/live-autocomplete.js"></script>
    <script type="text/javascript" src="http://96.sympy-live-tests.appspot.com/static/live-sphinx.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML-full"></script>
    <link rel="shortcut icon" href="../../../_static/sympy-notailtext-favicon.ico"/>
    <link rel="top" title="SymPy 1.0.1.dev documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sympy.polys.ring_series</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Power series evaluation and manipulation using sparse Polynomials</span>

<span class="sd">Implementing a new function</span>
<span class="sd">---------------------------</span>

<span class="sd">There are a few things to be kept in mind when adding a new function here::</span>

<span class="sd">    - The implementation should work on all possible input domains/rings.</span>
<span class="sd">      Special cases include the ``EX`` ring and a constant term in the series</span>
<span class="sd">      to be expanded. There can be two types of constant terms in the series:</span>

<span class="sd">        + A constant value or symbol.</span>
<span class="sd">        + A term of a multivariate series not involving the generator, with</span>
<span class="sd">          respect to which the series is to expanded.</span>

<span class="sd">      Strictly speaking, a generator of a ring should not be considered a</span>
<span class="sd">      constant. However, for series expansion both the cases need similar</span>
<span class="sd">      treatment (as the user doesn&#39;t care about inner details), i.e, use an</span>
<span class="sd">      addition formula to separate the constant part and the variable part (see</span>
<span class="sd">      rs_sin for reference).</span>

<span class="sd">    - All the algorithms used here are primarily designed to work for Taylor</span>
<span class="sd">      series (number of iterations in the algo equals the required order).</span>
<span class="sd">      Hence, it becomes tricky to get the series of the right order if a</span>
<span class="sd">      Puiseux series is input. Use rs_puiseux? in your function if your</span>
<span class="sd">      algorithm is not designed to handle fractional powers.</span>

<span class="sd">Extending rs_series</span>
<span class="sd">-------------------</span>

<span class="sd">To make a function work with rs_series you need to do two things::</span>

<span class="sd">    - Many sure it works with a constant term (as explained above).</span>
<span class="sd">    - If the series contains constant terms, you might need to extend its ring.</span>
<span class="sd">      You do so by adding the new terms to the rings as generators.</span>
<span class="sd">      ``PolyRing.compose`` and ``PolyRing.add_gens`` are two functions that do</span>
<span class="sd">      so and need to be called every time you expand a series containing a</span>
<span class="sd">      constant term.</span>

<span class="sd">Look at rs_sin and rs_series for further reference.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">sympy.polys.domains</span> <span class="kn">import</span> <span class="n">QQ</span><span class="p">,</span> <span class="n">EX</span>
<span class="kn">from</span> <span class="nn">sympy.polys.rings</span> <span class="kn">import</span> <span class="n">PolyElement</span><span class="p">,</span> <span class="n">ring</span><span class="p">,</span> <span class="n">sring</span>
<span class="kn">from</span> <span class="nn">sympy.polys.polyerrors</span> <span class="kn">import</span> <span class="n">DomainError</span>
<span class="kn">from</span> <span class="nn">sympy.polys.monomials</span> <span class="kn">import</span> <span class="p">(</span><span class="n">monomial_min</span><span class="p">,</span> <span class="n">monomial_mul</span><span class="p">,</span> <span class="n">monomial_div</span><span class="p">,</span>
                                   <span class="n">monomial_ldiv</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">mpmath.libmp.libintmath</span> <span class="kn">import</span> <span class="n">ifac</span>
<span class="kn">from</span> <span class="nn">sympy.core</span> <span class="kn">import</span> <span class="n">PoleError</span><span class="p">,</span> <span class="n">Function</span><span class="p">,</span> <span class="n">Expr</span>
<span class="kn">from</span> <span class="nn">sympy.core.numbers</span> <span class="kn">import</span> <span class="n">Rational</span><span class="p">,</span> <span class="n">igcd</span>
<span class="kn">from</span> <span class="nn">sympy.core.compatibility</span> <span class="kn">import</span> <span class="n">as_int</span><span class="p">,</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">sympy.functions</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">atan</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">atanh</span><span class="p">,</span> <span class="n">tanh</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">ceiling</span>
<span class="kn">from</span> <span class="nn">mpmath.libmp.libintmath</span> <span class="kn">import</span> <span class="n">giant_steps</span>
<span class="kn">import</span> <span class="nn">math</span>


<span class="k">def</span> <span class="nf">_invert_monoms</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute ``x**n * p1(1/x)`` for a univariate polynomial ``p1`` in ``x``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import ZZ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import _invert_monoms</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, ZZ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 + 2*x + 3</span>
<span class="sd">    &gt;&gt;&gt; _invert_monoms(p)</span>
<span class="sd">    3*x**2 + 2*x + 1</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    sympy.polys.densebasic.dup_reverse</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">terms</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">cv</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">listcoeffs</span><span class="p">()</span>
    <span class="n">mv</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">listmonoms</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mv</span><span class="p">)):</span>
        <span class="n">p</span><span class="p">[(</span><span class="n">deg</span> <span class="o">-</span> <span class="n">mv</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],)]</span> <span class="o">=</span> <span class="n">cv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p</span>

<span class="k">def</span> <span class="nf">_giant_steps</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a list of precision steps for the Newton&#39;s method&quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">giant_steps</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">res</span>

<div class="viewcode-block" id="rs_trunc"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_trunc">[docs]</a><span class="k">def</span> <span class="nf">rs_trunc</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Truncate the series in the ``x`` variable with precision ``prec``,</span>
<span class="sd">    that is, modulo ``O(x**prec)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_trunc</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**10 + x**5 + x + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_trunc(p, x, 12)</span>
<span class="sd">    x**10 + x**5 + x + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_trunc(p, x, 10)</span>
<span class="sd">    x**5 + x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">exp1</span> <span class="ow">in</span> <span class="n">p1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">exp1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prec</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">p</span><span class="p">[</span><span class="n">exp1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="n">exp1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="rs_is_puiseux"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_is_puiseux">[docs]</a><span class="k">def</span> <span class="nf">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test if ``p`` is Puiseux series in ``x``.</span>

<span class="sd">    Raise an exception if it has a negative power in ``x``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_is_puiseux</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**QQ(2,5) + x**QQ(2,3) + x</span>
<span class="sd">    &gt;&gt;&gt; rs_is_puiseux(p, x)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The series is not regular in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="rs_puiseux"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_puiseux">[docs]</a><span class="k">def</span> <span class="nf">rs_puiseux</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the puiseux series for `f(p, x, prec)`.</span>

<span class="sd">    To be used when function ``f`` is implemented only for regular series.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_puiseux, rs_exp</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**QQ(2,5) + x**QQ(2,3) + x</span>
<span class="sd">    &gt;&gt;&gt; rs_puiseux(rs_exp,p, x, 1)</span>
<span class="sd">    1/2*x**(4/5) + x**(2/3) + x**(2/5) + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">power</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">Rational</span><span class="p">):</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">power</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">den</span> <span class="o">//</span> <span class="n">igcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">den</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">power</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">power</span><span class="p">):</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">power</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">power</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">den</span> <span class="o">//</span> <span class="n">igcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">den</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pow_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">pow_xin</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span> <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">pow_xin</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="rs_puiseux2"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_puiseux2">[docs]</a><span class="k">def</span> <span class="nf">rs_puiseux2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the puiseux series for `f(p, q, x, prec)`.</span>

<span class="sd">    To be used when function ``f`` is implemented only for regular series.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">power</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="n">Rational</span><span class="p">):</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">power</span><span class="o">.</span><span class="n">as_numer_denom</span><span class="p">()</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">den</span> <span class="o">//</span> <span class="n">igcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">power</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">power</span><span class="p">):</span>
            <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">power</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span> <span class="n">power</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">den</span> <span class="o">//</span> <span class="n">igcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pow_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">pow_xin</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="rs_mul"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_mul">[docs]</a><span class="k">def</span> <span class="nf">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the product of the given two series, modulo ``O(x**prec)``.</span>

<span class="sd">    ``x`` is the series variable or its position in the generators.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_mul</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p1 = x**2 + 2*x + 1</span>
<span class="sd">    &gt;&gt;&gt; p2 = x + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_mul(p1, p2, x, 3)</span>
<span class="sd">    3*x**2 + 3*x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">__class__</span> <span class="o">!=</span> <span class="n">p2</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">or</span> <span class="n">R</span> <span class="o">!=</span> <span class="n">p2</span><span class="o">.</span><span class="n">ring</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p1 and p2 must have the same ring&#39;</span><span class="p">)</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;p1 and p2 must have the same ring&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span> <span class="o">==</span> <span class="n">p2</span><span class="o">.</span><span class="n">ring</span><span class="p">:</span>
        <span class="n">get</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span>
        <span class="n">items2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p2</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">items2</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iv</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">exp2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">items2</span><span class="p">:</span>
                    <span class="n">exp</span> <span class="o">=</span> <span class="n">exp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">exp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">exp</span> <span class="o">&lt;</span> <span class="n">prec</span><span class="p">:</span>
                        <span class="n">exp</span> <span class="o">=</span> <span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="p">)</span>
                        <span class="n">p</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v1</span><span class="o">*</span><span class="n">v2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">monomial_mul</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">monomial_mul</span>
            <span class="k">for</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">exp2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">items2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">exp1</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">+</span> <span class="n">exp2</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prec</span><span class="p">:</span>
                        <span class="n">exp</span> <span class="o">=</span> <span class="n">monomial_mul</span><span class="p">(</span><span class="n">exp1</span><span class="p">,</span> <span class="n">exp2</span><span class="p">)</span>
                        <span class="n">p</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v1</span><span class="o">*</span><span class="n">v2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">break</span>

    <span class="n">p</span><span class="o">.</span><span class="n">strip_zero</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="rs_square"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_square">[docs]</a><span class="k">def</span> <span class="nf">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Square the series modulo ``O(x**prec)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_square</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 + 2*x + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_square(p, x, 3)</span>
<span class="sd">    6*x**2 + 4*x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">iv</span><span class="p">])</span>
    <span class="n">monomial_mul</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">monomial_mul</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)):</span>
        <span class="n">exp1</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">exp2</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">exp1</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">+</span> <span class="n">exp2</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prec</span><span class="p">:</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">monomial_mul</span><span class="p">(</span><span class="n">exp1</span><span class="p">,</span> <span class="n">exp2</span><span class="p">)</span>
                <span class="n">p</span><span class="p">[</span><span class="n">exp</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v1</span><span class="o">*</span><span class="n">v2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">imul_num</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get</span>
    <span class="k">for</span> <span class="n">expv</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="mi">2</span><span class="o">*</span><span class="n">expv</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prec</span><span class="p">:</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">monomial_mul</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">expv</span><span class="p">)</span>
            <span class="n">p</span><span class="p">[</span><span class="n">e2</span><span class="p">]</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="n">e2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">p</span><span class="o">.</span><span class="n">strip_zero</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="rs_pow"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_pow">[docs]</a><span class="k">def</span> <span class="nf">rs_pow</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``p1**n`` modulo ``O(x**prec)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_pow</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_pow(p, 4, x, 3)</span>
<span class="sd">    6*x**2 + 4*x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Rational</span><span class="p">):</span>
        <span class="n">np</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
        <span class="n">nq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nq</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">rs_nth_root</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">nq</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">as_int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;0**0 is undefined&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="o">-</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="rs_subs"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_subs">[docs]</a><span class="k">def</span> <span class="nf">rs_subs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">rules</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Substitution with truncation according to the mapping in ``rules``.</span>

<span class="sd">    Return a series with precision ``prec`` in the generator ``x``</span>

<span class="sd">    Note that substitutions are not done one after the other</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_subs</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 + y**2</span>
<span class="sd">    &gt;&gt;&gt; rs_subs(p, {x: x+ y, y: x+ 2*y}, x, 3)</span>
<span class="sd">    2*x**2 + 6*x*y + 5*y**2</span>
<span class="sd">    &gt;&gt;&gt; (x + y)**2 + (x + 2*y)**2</span>
<span class="sd">    2*x**2 + 6*x*y + 5*y**2</span>

<span class="sd">    which differs from</span>

<span class="sd">    &gt;&gt;&gt; rs_subs(rs_subs(p, {x: x+ y}, x, 3), {y: x+ 2*y}, x, 3)</span>
<span class="sd">    5*x**2 + 12*x*y + 8*y**2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : :class:`PolyElement` Input series.</span>
<span class="sd">    rules : :class:`dict` with substitution mappings.</span>
<span class="sd">    x : :class:`PolyElement` in which the series truncation is to be done.</span>
<span class="sd">    prec : :class:`Integer` order of the series after truncation.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_subs</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_subs(x**2+y**2, {y: (x+y)**2}, x, 3)</span>
<span class="sd">     6*x**2*y**2 + x**2 + 4*x*y**3 + y**4</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">ngens</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngens</span><span class="p">):</span>
        <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[(</span><span class="n">R</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">),</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p_keys</span><span class="p">:</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngens</span><span class="p">):</span>
            <span class="n">power</span> <span class="o">=</span> <span class="n">expv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">q</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">power</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">q</span><span class="p">)],</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
                                           <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">power</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">d</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">power</span><span class="p">)],</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">+=</span> <span class="n">p2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">expv</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p1</span></div>

<span class="k">def</span> <span class="nf">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if ``p`` has a constant term in ``x``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import _has_constant_term</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 + x + 1</span>
<span class="sd">    &gt;&gt;&gt; _has_constant_term(p, x)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">iv</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">a</span><span class="p">[</span><span class="n">iv</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">miv</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">monomial_min</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">miv</span><span class="p">)</span> <span class="o">==</span> <span class="n">zm</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">_get_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return constant term in p with respect to x</span>

<span class="sd">    Note that it is not simply `p[R.zero_monom]` as there might be multiple</span>
<span class="sd">    generators in the ring R. We want the `x`-free term which can contain other</span>
<span class="sd">    generators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">miv</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">monomial_min</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">miv</span><span class="p">)</span> <span class="o">==</span> <span class="n">zm</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="n">R</span><span class="p">({</span><span class="n">expv</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="n">expv</span><span class="p">]})</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="k">def</span> <span class="nf">_check_series_var</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PoleError</span><span class="p">(</span><span class="s2">&quot;Asymptotic expansion of </span><span class="si">%s</span><span class="s2"> around [oo] not &quot;</span>
                        <span class="s2">&quot;implemented.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">_series_inversion1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate series inversion ``1/p`` modulo ``O(x**prec)``.</span>

<span class="sd">    The Newton method is used.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import _series_inversion1</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x + 1</span>
<span class="sd">    &gt;&gt;&gt; _series_inversion1(p, x, 4)</span>
<span class="sd">    -x**3 + x**2 - x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">_series_inversion1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>

    <span class="c1"># giant_steps does not seem to work with PythonRational numbers with 1 as</span>
    <span class="c1"># denominator. This makes sure such a number is converted to integer.</span>
    <span class="k">if</span> <span class="n">prec</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">zm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No constant term in series&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p cannot contain a constant term depending on &quot;</span>
                         <span class="s2">&quot;parameters&quot;</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
        <span class="n">one</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">one</span><span class="p">:</span>
        <span class="c1"># TODO add check that it is a unit</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">c</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p1</span>

<div class="viewcode-block" id="rs_series_inversion"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_series_inversion">[docs]</a><span class="k">def</span> <span class="nf">rs_series_inversion</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multivariate series inversion ``1/p`` modulo ``O(x**prec)``.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_series_inversion</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_series_inversion(1 + x*y**2, x, 4)</span>
<span class="sd">    -x**3*y**6 + x**2*y**4 - x*y**2 + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_series_inversion(1 + x*y**2, y, 4)</span>
<span class="sd">    -x*y**2 + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_series_inversion(x + x**2, x, 4)</span>
<span class="sd">    x**3 - x**2 + x - 1 + x**(-1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ZeroDivisionError</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>
        <span class="n">prec</span> <span class="o">=</span> <span class="n">prec</span> <span class="o">+</span> <span class="n">m</span>
    <span class="k">if</span> <span class="n">zm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;No constant term in series&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">],</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;p - p[0] must not have a constant term in &quot;</span>
                                  <span class="s2">&quot;the series variables&quot;</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">_series_inversion1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>

<span class="k">def</span> <span class="nf">_coefficient_t</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Coefficient of `x\_i**j` in p, where ``t`` = (i, j)&quot;&quot;&quot;</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">expv1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">expv1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
    <span class="n">expv1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">expv1</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">expv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">[</span><span class="n">monomial_div</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">expv1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">expv</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p1</span>

<div class="viewcode-block" id="rs_series_reversion"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_series_reversion">[docs]</a><span class="k">def</span> <span class="nf">rs_series_reversion</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reversion of a series.</span>

<span class="sd">    ``p`` is a series with ``O(x**n)`` of the form `p = a*x + f(x)`</span>
<span class="sd">    where `a` is a number different from 0.</span>

<span class="sd">    `f(x) = sum( a\_k*x\_k, k in range(2, n))`</span>

<span class="sd">      a_k : Can depend polynomially on other variables, not indicated.</span>
<span class="sd">      x : Variable with name x.</span>
<span class="sd">      y : Variable with name y.</span>

<span class="sd">    Solve `p = y`, that is, given `a*x + f(x) - y = 0`,</span>
<span class="sd">    find the solution x = r(y) up to O(y**n)</span>

<span class="sd">    Algorithm:</span>

<span class="sd">    If `r\_i` is the solution at order i, then:</span>
<span class="sd">    `a*r\_i + f(r\_i) - y = O(y**(i + 1))`</span>

<span class="sd">    and if r_(i + 1) is the solution at order i + 1, then:</span>
<span class="sd">    `a*r\_(i + 1) + f(r\_(i + 1)) - y = O(y**(i + 2))`</span>

<span class="sd">    We have, r_(i + 1) = r_i + e, such that,</span>
<span class="sd">    `a*e + f(r\_i) = O(y**(i + 2))`</span>
<span class="sd">    or `e = -f(r\_i)/a`</span>

<span class="sd">    So we use the recursion relation:</span>
<span class="sd">    `r\_(i + 1) = r\_i - f(r\_i)/a`</span>
<span class="sd">    with the boundary condition: `r\_1 = y`</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_series_reversion, rs_trunc</span>
<span class="sd">    &gt;&gt;&gt; R, x, y, a, b = ring(&#39;x, y, a, b&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x - x**2 - 2*b*x**2 + 2*a*b*x**2</span>
<span class="sd">    &gt;&gt;&gt; p1 = rs_series_reversion(p, x, 3, y); p1</span>
<span class="sd">    -2*y**2*a*b + 2*y**2*b + y**2 + y</span>
<span class="sd">    &gt;&gt;&gt; rs_trunc(p.compose(x, p1), y, 3)</span>
<span class="sd">    y</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;p must not contain a constant term in the series &quot;</span>
                         <span class="s2">&quot;variable&quot;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">_coefficient_t</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="k">assert</span> <span class="n">zm</span> <span class="ow">in</span> <span class="n">a</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">a</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">rs_subs</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">r</span><span class="p">},</span> <span class="n">y</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">_coefficient_t</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="p">(</span><span class="n">ny</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="n">i</span>
        <span class="n">r</span> <span class="o">-=</span> <span class="n">sp</span><span class="o">/</span><span class="n">a</span>
    <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="rs_series_from_list"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_series_from_list">[docs]</a><span class="k">def</span> <span class="nf">rs_series_from_list</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">concur</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a series `sum c[n]*p**n` modulo `O(x**prec)`.</span>

<span class="sd">    It reduces the number of multiplications by summing concurrently.</span>

<span class="sd">    `ax = [1, p, p**2, .., p**(J - 1)]`</span>
<span class="sd">    `s = sum(c[i]*ax[i]` for i in `range(r, (r + 1)*J))*p**((K - 1)*J)`</span>
<span class="sd">    with `K &gt;= (n + 1)/J`</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_series_from_list, rs_trunc</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 + x + 1</span>
<span class="sd">    &gt;&gt;&gt; c = [1, 2, 3]</span>
<span class="sd">    &gt;&gt;&gt; rs_series_from_list(p, c, x, 4)</span>
<span class="sd">    6*x**3 + 11*x**2 + 8*x + 6</span>
<span class="sd">    &gt;&gt;&gt; rs_trunc(1 + 2*p + 3*p**2, x, 4)</span>
<span class="sd">    6*x**3 + 11*x**2 + 8*x + 6</span>
<span class="sd">    &gt;&gt;&gt; pc = R.from_list(list(reversed(c)))</span>
<span class="sd">    &gt;&gt;&gt; rs_trunc(pc.compose(x, p), x, 4)</span>
<span class="sd">    6*x**3 + 11*x**2 + 8*x + 6</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    sympy.polys.ring.compose</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">concur</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">q</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">q</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="n">J</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">K</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">J</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
        <span class="n">K</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="c1"># optimize using rs_square</span>
    <span class="n">pj</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">J</span><span class="o">*</span><span class="n">k</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">):</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">s1</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">pj</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">K</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">J</span><span class="o">*</span><span class="n">k</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">s1</span>
    <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="rs_diff"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_diff">[docs]</a><span class="k">def</span> <span class="nf">rs_diff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return partial derivative of ``p`` with respect to ``x``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : :class:`PolyElement` with respect to which ``p`` is differentiated.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_diff</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x + x**2*y**3</span>
<span class="sd">    &gt;&gt;&gt; rs_diff(p, x)</span>
<span class="sd">    2*x*y**3 + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">mn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">expv</span><span class="p">[</span><span class="n">n</span><span class="p">]:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">monomial_ldiv</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>
            <span class="n">p1</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">expv</span><span class="p">]</span><span class="o">*</span><span class="n">expv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p1</span></div>

<div class="viewcode-block" id="rs_integrate"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_integrate">[docs]</a><span class="k">def</span> <span class="nf">rs_integrate</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate ``p`` with respect to ``x``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : :class:`PolyElement` with respect to which ``p`` is integrated.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_integrate</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x + x**2*y**3</span>
<span class="sd">    &gt;&gt;&gt; rs_integrate(p, x)</span>
<span class="sd">    1/3*x**3*y**3 + 1/2*x**2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span><span class="o">.</span><span class="n">ngens</span>
    <span class="n">mn</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">expv</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">monomial_mul</span><span class="p">(</span><span class="n">expv</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">expv</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">expv</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p1</span></div>

<div class="viewcode-block" id="rs_fun"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_fun">[docs]</a><span class="k">def</span> <span class="nf">rs_fun</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function of a multivariate series computed by substitution.</span>

<span class="sd">    The case with f method name is used to compute `rs\_tan` and `rs\_nth\_root`</span>
<span class="sd">    of a multivariate series:</span>

<span class="sd">        `rs\_fun(p, tan, iv, prec)`</span>

<span class="sd">        tan series is first computed for a dummy variable _x,</span>
<span class="sd">        i.e, `rs\_tan(\_x, iv, prec)`. Then we substitute _x with p to get the</span>
<span class="sd">        desired series</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : :class:`PolyElement` The multivariate series to be expanded.</span>
<span class="sd">    f : `ring\_series` function to be applied on `p`.</span>
<span class="sd">    args[-2] : :class:`PolyElement` with respect to which, the series is to be expanded.</span>
<span class="sd">    args[-1] : Required order of the expanded series.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_fun, _tan1</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x + x*y + x**2*y + x**3*y**2</span>
<span class="sd">    &gt;&gt;&gt; rs_fun(p, _tan1, x, 4)</span>
<span class="sd">    1/3*x**3*y**3 + 2*x**3*y**2 + x**3*y + 1/3*x**3 + x**2*y + x*y + x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">R1</span><span class="p">,</span> <span class="n">_x</span> <span class="o">=</span> <span class="n">ring</span><span class="p">(</span><span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="n">_R</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">args1</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">_R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="c1"># separate the constant term of the series</span>
    <span class="c1"># compute the univariate series f(_x, .., &#39;x&#39;, sum(nv))</span>
    <span class="k">if</span> <span class="n">zm</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">_x</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">_x</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">f</span><span class="p">)(</span><span class="o">*</span><span class="n">args1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="o">*</span><span class="n">args1</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">h</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">p1</span></div>

<div class="viewcode-block" id="mul_xin"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.mul_xin">[docs]</a><span class="k">def</span> <span class="nf">mul_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `p*x_i**n`.</span>

<span class="sd">    `x\_i` is the ith variable in ``p``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">n</span>
        <span class="n">q</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="pow_xin"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.pow_xin">[docs]</a><span class="k">def</span> <span class="nf">pow_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import pow_xin</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**QQ(2,5) + x + x**QQ(2,3)</span>
<span class="sd">    &gt;&gt;&gt; index = p.ring.gens.index(x)</span>
<span class="sd">    &gt;&gt;&gt; pow_xin(p, index, 15)</span>
<span class="sd">    x**15 + x**10 + x**6</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">n</span>
        <span class="n">q</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">k1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">q</span></div>

<span class="k">def</span> <span class="nf">_nth_root1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Univariate series expansion of the nth root of ``p``.</span>

<span class="sd">    The Newton method is used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux2</span><span class="p">(</span><span class="n">_nth_root1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="k">if</span> <span class="n">zm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;No constant term in series&#39;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">as_int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">+=</span> <span class="n">p1</span><span class="o">/</span><span class="n">n</span> <span class="o">-</span> <span class="n">tmp</span><span class="o">/</span><span class="n">n</span>
    <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">p1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_series_inversion1</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

<div class="viewcode-block" id="rs_nth_root"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_nth_root">[docs]</a><span class="k">def</span> <span class="nf">rs_nth_root</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Multivariate series expansion of the nth root of ``p``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : `p**(1/n)` is returned.</span>
<span class="sd">    x : :class:`PolyElement`</span>
<span class="sd">    prec : Order of the expanded series.</span>

<span class="sd">    Notes</span>
<span class="sd">    =====</span>

<span class="sd">    The result of this function is dependent on the ring over which the</span>
<span class="sd">    polynomial has been defined. If the answer involves a root of a constant,</span>
<span class="sd">    make sure that the polynomial is over a real field. It can not yet handle</span>
<span class="sd">    roots of symbols.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ, RR</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_nth_root</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_nth_root(1 + x + x*y, -3, x, 3)</span>
<span class="sd">    2/9*x**2*y**2 + 4/9*x**2*y + 2/9*x**2 - 1/3*x*y - 1/3*x + 1</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, RR)</span>
<span class="sd">    &gt;&gt;&gt; rs_nth_root(3 + x + x*y, 3, x, 2)</span>
<span class="sd">    0.160249952256379*x*y + 0.160249952256379*x + 1.44224957030741</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">n</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;0**0 expression&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="n">index</span><span class="p">])[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>
    <span class="n">prec</span> <span class="o">-=</span> <span class="n">m</span>

    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">c_expr</span><span class="o">**</span><span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">c_expr</span><span class="o">**</span><span class="p">(</span><span class="n">QQ</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>                              <span class="c1"># RealElement doesn&#39;t support</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">Rational</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>  <span class="c1"># exponentiation with mpq object</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>                <span class="c1"># as exponent</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">rs_nth_root</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span><span class="o">*</span><span class="n">const</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_nth_root1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">QQ</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="rs_log"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_log">[docs]</a><span class="k">def</span> <span class="nf">rs_log</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Logarithm of ``p`` modulo ``O(x**prec)``.</span>

<span class="sd">    Notes</span>
<span class="sd">    =====</span>

<span class="sd">    Truncation of ``integral dx p**-1*d p/dx`` is used.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_log</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_log(1 + x, x, 8)</span>
<span class="sd">    1/7*x**7 - 1/6*x**6 + 1/5*x**5 - 1/4*x**4 + 1/3*x**3 - 1/2*x**2 + x</span>
<span class="sd">    &gt;&gt;&gt; rs_log(x**QQ(3, 2) + 1, x, 5)</span>
<span class="sd">    1/3*x**(9/2) - 1/2*x**3 + x**(3/2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_log</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                        <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                        <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>

        <span class="n">dlog</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">dlog</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">dlog</span><span class="p">,</span> <span class="n">_series_inversion1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_integrate</span><span class="p">(</span><span class="n">dlog</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="rs_LambertW"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_LambertW">[docs]</a><span class="k">def</span> <span class="nf">rs_LambertW</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the series expansion of the principal branch of the Lambert W</span>
<span class="sd">    function.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_LambertW</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_LambertW(x + x*y, x, 3)</span>
<span class="sd">    -x**2*y**2 - 2*x**2*y - x**2 + x*y + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    LambertW</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_LambertW</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Polynomial must not have constant term in &quot;</span>
                                  <span class="s2">&quot;the series variables&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">rs_exp</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span> <span class="o">-</span> <span class="n">p</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">-=</span> <span class="n">tmp</span>
        <span class="k">return</span> <span class="n">p1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<span class="k">def</span> <span class="nf">_exp1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper function for `rs\_exp`. &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">rs_log</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">+=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">p1</span>

<div class="viewcode-block" id="rs_exp"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_exp">[docs]</a><span class="k">def</span> <span class="nf">rs_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exponentiation of a series modulo ``O(x**prec)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_exp</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_exp(x**2, x, 7)</span>
<span class="sd">    1/6*x**6 + 1/2*x**4 + x**2 + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_exp</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">_get_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">add_gens</span><span class="p">([</span><span class="n">exp</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">c</span>

    <span class="c1"># Makes use of sympy fuctions to evaluate the values of the cos/sin</span>
    <span class="c1"># of the constant term.</span>
        <span class="k">return</span> <span class="n">const</span><span class="o">*</span><span class="n">rs_exp</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_exp1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">n</span> <span class="o">*=</span> <span class="n">k</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span></div>

<span class="k">def</span> <span class="nf">_atan</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expansion using formula.</span>

<span class="sd">    Faster on very small and univariate series.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">mo</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">mo</span><span class="p">]</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mo</span><span class="o">**</span><span class="n">k</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="rs_atan"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_atan">[docs]</a><span class="k">def</span> <span class="nf">rs_atan</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The arctangent of a series</span>

<span class="sd">    Return the series expansion of the atan of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_atan</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_atan(x + x*y, x, 4)</span>
<span class="sd">    -1/3*x**3*y**3 - x**3*y**2 - x**3*y - 1/3*x**3 + x*y + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    atan</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_atan</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">atan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">atan</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>

    <span class="c1"># Instead of using a closed form formula, we differentiate atan(p) to get</span>
    <span class="c1"># `1/(1+p**2) * dp`, whose series expansion is much easier to calculate.</span>
    <span class="c1"># Finally we integrate to get back atan</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="o">+</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs_integrate</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span></div>

<div class="viewcode-block" id="rs_asin"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_asin">[docs]</a><span class="k">def</span> <span class="nf">rs_asin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Arcsine of a series</span>

<span class="sd">    Return the series expansion of the asin of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_asin</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_asin(x, x, 8)</span>
<span class="sd">    5/112*x**7 + 3/40*x**5 + 1/6*x**3 + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    asin</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_asin</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Polynomial must not have constant term in &quot;</span>
                                  <span class="s2">&quot;series variables&quot;</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">:</span>
        <span class="c1"># get a good value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">rs_diff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_nth_root</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rs_integrate</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<span class="k">def</span> <span class="nf">_tan1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function of `rs\_tan`.</span>

<span class="sd">    Return the series expansion of tan of a univariate series using Newton&#39;s</span>
<span class="sd">    method. It takes advantage of the fact that series expansion of atan is</span>
<span class="sd">    easier than that of tan.</span>

<span class="sd">    Consider `f(x) = y - atan(x)`</span>
<span class="sd">    Let r be a root of f(x) found using Newton&#39;s method.</span>
<span class="sd">    Then `f(r) = 0`</span>
<span class="sd">    Or `y  = atan(x)` where `x = tan(y)` as required.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">rs_atan</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">+=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">p1</span>

<div class="viewcode-block" id="rs_tan"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_tan">[docs]</a><span class="k">def</span> <span class="nf">rs_tan</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tangent of a series.</span>

<span class="sd">    Return the series expansion of the tan of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_tan</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_tan(x + x*y, x, 4)</span>
<span class="sd">    1/3*x**3*y**3 + x**3*y**2 + x**3*y + 1/3*x**3 + x*y + x</span>

<span class="sd">   See Also</span>
<span class="sd">   ========</span>

<span class="sd">   _tan1, tan</span>
<span class="sd">   &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_tan</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">_get_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">tan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">add_gens</span><span class="p">([</span><span class="n">tan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">,</span> <span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">tan</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">c</span>

    <span class="c1"># Makes use of sympy fuctions to evaluate the values of the cos/sin</span>
    <span class="c1"># of the constant term.</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">rs_tan</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">*</span><span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">const</span> <span class="o">+</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_tan1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_fun</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">rs_tan</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="rs_cot"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_cot">[docs]</a><span class="k">def</span> <span class="nf">rs_cot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cotangent of a series</span>

<span class="sd">    Return the series expansion of the cot of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_cot</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_cot(x, x, 6)</span>
<span class="sd">    -2/945*x**5 - 1/45*x**3 - 1/3*x + x**(-1)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    cot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># It can not handle series like `p = x + x*y` where the coefficient of the</span>
    <span class="c1"># linear term in the series variable is symbolic.</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_cot</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_check_series_var</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;cot&#39;</span><span class="p">)</span>
    <span class="n">prec1</span> <span class="o">=</span> <span class="n">prec</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m</span>
    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">rs_cos_sin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec1</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">mul_xin</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">m</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="rs_sin"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_sin">[docs]</a><span class="k">def</span> <span class="nf">rs_sin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sine of a series</span>

<span class="sd">    Return the series expansion of the sin of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_sin</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_sin(x + x*y, x, 4)</span>
<span class="sd">    -1/6*x**3*y**3 - 1/2*x**3*y**2 - 1/2*x**3*y - 1/6*x**3 + x*y + x</span>
<span class="sd">    &gt;&gt;&gt; rs_sin(x**QQ(3, 2) + x*y**QQ(7, 5), x, 4)</span>
<span class="sd">    -1/2*x**(7/2)*y**(14/5) - 1/6*x**3*y**(21/5) + x**(3/2) + x*y**(7/5)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    sin</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_sin</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ring</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">_get_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">add_gens</span><span class="p">([</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">c</span>

    <span class="c1"># Makes use of sympy cos, sin fuctions to evaluate the values of the</span>
    <span class="c1"># cos/sin of the constant term.</span>
        <span class="k">return</span> <span class="n">rs_sin</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span><span class="o">*</span><span class="n">t2</span> <span class="o">+</span> <span class="n">rs_cos</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span><span class="o">*</span><span class="n">t1</span>

    <span class="c1"># Series is calculated in terms of tan as its evaluation is fast.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rs_tan</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">prec</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">*=</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="rs_cos"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_cos">[docs]</a><span class="k">def</span> <span class="nf">rs_cos</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cosine of a series</span>

<span class="sd">    Return the series expansion of the cos of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_cos</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_cos(x + x*y, x, 4)</span>
<span class="sd">    -1/2*x**2*y**2 - x**2*y - 1/2*x**2 + 1</span>
<span class="sd">    &gt;&gt;&gt; rs_cos(x + x*y, x, 4)/x**QQ(7, 5)</span>
<span class="sd">    -1/2*x**(3/5)*y**2 - x**(3/5)*y - 1/2*x**(3/5) + x**(-7/5)</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    cos</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_cos</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">_get_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">add_gens</span><span class="p">([</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">c</span>

    <span class="c1"># Makes use of sympy cos, sin fuctions to evaluate the values of the</span>
    <span class="c1"># cos/sin of the constant term.</span>
        <span class="n">p_cos</span> <span class="o">=</span> <span class="n">rs_cos</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">p_sin</span> <span class="o">=</span> <span class="n">rs_sin</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">p_cos</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">p_sin</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
        <span class="n">p_cos</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="n">p_sin</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)),</span> <span class="n">R</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">p_cos</span><span class="o">*</span><span class="n">t2</span> <span class="o">-</span> <span class="n">p_sin</span><span class="o">*</span><span class="n">t1</span>

    <span class="c1"># Series is calculated in terms of tan as its evaluation is fast.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rs_tan</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">prec</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">*=</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="rs_cos_sin"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_cos_sin">[docs]</a><span class="k">def</span> <span class="nf">rs_cos_sin</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the tuple `(rs\_cos(p, x, prec)`, `rs\_sin(p, x, prec))`.</span>

<span class="sd">    Is faster than calling rs_cos and rs_sin separately</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_cos_sin</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">rs_tan</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">t2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">))</span></div>

<span class="k">def</span> <span class="nf">_atanh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expansion using formula</span>

<span class="sd">    Faster for very small and univariate series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">one</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">rs_series_from_list</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="rs_atanh"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_atanh">[docs]</a><span class="k">def</span> <span class="nf">rs_atanh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperbolic arctangent of a series</span>

<span class="sd">    Return the series expansion of the atanh of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_atanh</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_atanh(x + x*y, x, 4)</span>
<span class="sd">    1/3*x**3*y**3 + x**3*y**2 + x**3*y + 1/3*x**3 + x*y + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    atanh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_atanh</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">atanh</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">atanh</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">atanh</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>

    <span class="c1"># Instead of using a closed form formula, we differentiate atanh(p) to get</span>
    <span class="c1"># `1/(1-p**2) * dp`, whose series expansion is much easier to calculate.</span>
    <span class="c1"># Finally we integrate to get back atanh</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">rs_diff</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="o">-</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs_integrate</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">const</span></div>

<div class="viewcode-block" id="rs_sinh"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_sinh">[docs]</a><span class="k">def</span> <span class="nf">rs_sinh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperbolic sine of a series</span>

<span class="sd">    Return the series expansion of the sinh of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_sinh</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_sinh(x + x*y, x, 4)</span>
<span class="sd">    1/6*x**3*y**3 + 1/2*x**3*y**2 + 1/2*x**3*y + 1/6*x**3 + x*y + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    sinh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_sinh</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">rs_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span></div>

<div class="viewcode-block" id="rs_cosh"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_cosh">[docs]</a><span class="k">def</span> <span class="nf">rs_cosh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperbolic cosine of a series</span>

<span class="sd">    Return the series expansion of the cosh of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_cosh</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_cosh(x + x*y, x, 4)</span>
<span class="sd">    1/2*x**2*y**2 + x**2*y + 1/2*x**2 + 1</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    cosh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_cosh</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">rs_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span></div>

<span class="k">def</span> <span class="nf">_tanh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function of `rs\_tanh`</span>

<span class="sd">    Return the series expansion of tanh of a univariate series using Newton&#39;s</span>
<span class="sd">    method. It takes advantage of the fact that series expansion of atanh is</span>
<span class="sd">    easier than that of tanh.</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    _tanh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">precx</span> <span class="ow">in</span> <span class="n">_giant_steps</span><span class="p">(</span><span class="n">prec</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">rs_atanh</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rs_square</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">precx</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">+=</span> <span class="n">tmp</span>
    <span class="k">return</span> <span class="n">p1</span>

<div class="viewcode-block" id="rs_tanh"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_tanh">[docs]</a><span class="k">def</span> <span class="nf">rs_tanh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hyperbolic tangent of a series</span>

<span class="sd">    Return the series expansion of the tanh of ``p``, about 0.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_tanh</span>
<span class="sd">    &gt;&gt;&gt; R, x, y = ring(&#39;x, y&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; rs_tanh(x + x*y, x, 4)</span>
<span class="sd">    -1/3*x**3*y**3 - x**3*y**2 - x**3*y - 1/3*x**3 + x*y + x</span>

<span class="sd">    See Also</span>
<span class="sd">    ========</span>

<span class="sd">    tanh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rs_is_puiseux</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rs_puiseux</span><span class="p">(</span><span class="n">rs_tanh</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">const</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">_has_constant_term</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">zm</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero_monom</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">zm</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="ow">is</span> <span class="n">EX</span><span class="p">:</span>
            <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
            <span class="n">const</span> <span class="o">=</span> <span class="n">tanh</span><span class="p">(</span><span class="n">c_expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PolyElement</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c_expr</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">as_expr</span><span class="p">()</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">tanh</span><span class="p">(</span><span class="n">c_expr</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">const</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">tanh</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DomainError</span><span class="p">(</span><span class="s2">&quot;The given series can&#39;t be expanded in &quot;</span>
                    <span class="s2">&quot;this domain.&quot;</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">c</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">rs_tanh</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">const</span><span class="o">*</span><span class="n">t1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">const</span> <span class="o">+</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">ngens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_tanh</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_fun</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_tanh</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span></div>

<div class="viewcode-block" id="rs_newton"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_newton">[docs]</a><span class="k">def</span> <span class="nf">rs_newton</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the truncated Newton sum of the polynomial ``p``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_newton</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = x**2 - 2</span>
<span class="sd">    &gt;&gt;&gt; rs_newton(p, x, 5)</span>
<span class="sd">    8*x**4 + 4*x**2 + 2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">_invert_monoms</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">rs_series_inversion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">p2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">deg</span> <span class="o">-</span> <span class="n">p3</span><span class="o">*</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="rs_hadamard_exp"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_hadamard_exp">[docs]</a><span class="k">def</span> <span class="nf">rs_hadamard_exp</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return ``sum f_i/i!*x**i`` from ``sum f_i*x**i``,</span>
<span class="sd">    where ``x`` is the first variable.</span>

<span class="sd">    If ``invers=True`` return ``sum f_i*i!*x**i``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_hadamard_exp</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; p = 1 + x + x**2 + x**3</span>
<span class="sd">    &gt;&gt;&gt; rs_hadamard_exp(p)</span>
<span class="sd">    1/6*x**3 + 1/2*x**2 + x + 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">domain</span> <span class="o">!=</span> <span class="n">QQ</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">zero</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">inverse</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p</span><span class="p">[</span><span class="n">exp1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">ifac</span><span class="p">(</span><span class="n">exp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">exp1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">p</span><span class="p">[</span><span class="n">exp1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">ifac</span><span class="p">(</span><span class="n">exp1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="rs_compose_add"><a class="viewcode-back" href="../../../modules/polys/ringseries.html#sympy.polys.ring_series.rs_compose_add">[docs]</a><span class="k">def</span> <span class="nf">rs_compose_add</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute the composed sum ``prod(p2(x - beta) for beta root of p1)``</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.rings import ring</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_compose_add</span>
<span class="sd">    &gt;&gt;&gt; R, x = ring(&#39;x&#39;, QQ)</span>
<span class="sd">    &gt;&gt;&gt; f = x**2 - 2</span>
<span class="sd">    &gt;&gt;&gt; g = x**2 - 3</span>
<span class="sd">    &gt;&gt;&gt; rs_compose_add(f, g)</span>
<span class="sd">    x**4 - 10*x**2 + 1</span>

<span class="sd">    References</span>
<span class="sd">    ==========</span>

<span class="sd">    A. Bostan, P. Flajolet, B. Salvy and E. Schost</span>
<span class="sd">    &quot;Fast Computation with Two Algebraic Numbers&quot;,</span>
<span class="sd">    (2002) Research Report 4579, Institut</span>
<span class="sd">    National de Recherche en Informatique et en Automatique</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">prec</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">*</span> <span class="n">p2</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">np1</span> <span class="o">=</span> <span class="n">rs_newton</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">np1e</span> <span class="o">=</span> <span class="n">rs_hadamard_exp</span><span class="p">(</span><span class="n">np1</span><span class="p">)</span>
    <span class="n">np2</span> <span class="o">=</span> <span class="n">rs_newton</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">np2e</span> <span class="o">=</span> <span class="n">rs_hadamard_exp</span><span class="p">(</span><span class="n">np2</span><span class="p">)</span>
    <span class="n">np3e</span> <span class="o">=</span> <span class="n">rs_mul</span><span class="p">(</span><span class="n">np1e</span><span class="p">,</span> <span class="n">np2e</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">np3</span> <span class="o">=</span> <span class="n">rs_hadamard_exp</span><span class="p">(</span><span class="n">np3e</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">np3a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np3</span><span class="p">[(</span><span class="mi">0</span><span class="p">,)]</span> <span class="o">-</span> <span class="n">np3</span><span class="p">)</span><span class="o">/</span><span class="n">x</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">rs_integrate</span><span class="p">(</span><span class="n">np3a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">rs_exp</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">_invert_monoms</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">primitive</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">*</span> <span class="n">p2</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span><span class="o">.</span><span class="n">degree</span><span class="p">()</span>
    <span class="c1"># `dp` is the multiplicity of the zeroes of the resultant;</span>
    <span class="c1"># these zeroes are missed in this computation so they are put here.</span>
    <span class="c1"># if p1 and p2 are monic irreducible polynomials,</span>
    <span class="c1"># there are zeroes in the resultant</span>
    <span class="c1"># if and only if p1 = p2 ; in fact in that case p1 and p2 have a</span>
    <span class="c1"># root in common, so gcd(p1, p2) != 1; being p1 and p2 irreducible</span>
    <span class="c1"># this means p1 = p2</span>
    <span class="k">if</span> <span class="n">dp</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">dp</span>
    <span class="k">return</span> <span class="n">q</span></div>


<span class="n">_convert_func</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;sin&#39;</span><span class="p">:</span> <span class="s1">&#39;rs_sin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;cos&#39;</span><span class="p">:</span> <span class="s1">&#39;rs_cos&#39;</span><span class="p">,</span>
        <span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="s1">&#39;rs_exp&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tan&#39;</span><span class="p">:</span> <span class="s1">&#39;rs_tan&#39;</span>
        <span class="p">}</span>

<span class="k">def</span> <span class="nf">rs_min_pow</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series_rs</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find the minimum power of `a` in the series expansion of expr&quot;&quot;&quot;</span>
    <span class="n">series</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">series</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series_rs</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">*=</span> <span class="mi">2</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">gens</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">i</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series_rs</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="c1"># TODO Use _parallel_dict_from_expr instead of sring as sring is</span>
    <span class="c1"># inefficient. For details, read the todo in sring.</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">args</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">series_rs</span><span class="o">.</span><span class="n">ring</span>

    <span class="c1"># expr does not contain any function to be expanded</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">Function</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">series_rs</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">expr</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">series_rs</span>

    <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Function</span><span class="p">:</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="n">R1</span><span class="p">,</span> <span class="n">series</span> <span class="o">=</span> <span class="n">sring</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">series_inner</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>

        <span class="c1"># Why do we need to compose these three rings?</span>
        <span class="c1">#</span>
        <span class="c1"># We want to use a simple domain (like ``QQ`` or ``RR``) but they don&#39;t</span>
        <span class="c1"># support symbolic coefficients. We need a ring that for example lets</span>
        <span class="c1"># us have `sin(1)` and `cos(1)` as coefficients if we are expanding</span>
        <span class="c1"># `sin(x + 1)`. The ``EX`` domain allows all symbolic coefficients, but</span>
        <span class="c1"># that makes it very complex and hence slow.</span>
        <span class="c1">#</span>
        <span class="c1"># To solve this problem, we add only those symbolic elements as</span>
        <span class="c1"># generators to our ring, that we need. Here, series_inner might</span>
        <span class="c1"># involve terms like `sin(4)`, `exp(a)`, etc, which are not there in</span>
        <span class="c1"># R1 or R. Hence, we compose these three rings to create one that has</span>
        <span class="c1"># the generators of all three.</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">series_inner</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
        <span class="n">series_inner</span> <span class="o">=</span> <span class="n">series_inner</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="n">series</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">_convert_func</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">func</span><span class="p">)])(</span><span class="n">series_inner</span><span class="p">,</span>
            <span class="n">R</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">series</span>

    <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>    <span class="c1"># XXX Looks redundant</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">arg</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
                <span class="n">R1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sring</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span>
        <span class="n">min_pows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">rs_min_pow</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="p">[</span><span class="n">R</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
        <span class="n">sum_pows</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">min_pows</span><span class="p">)</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">_series</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span> <span class="o">-</span> <span class="n">sum_pows</span> <span class="o">+</span>
                <span class="n">min_pows</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">_series</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
            <span class="n">_series</span> <span class="o">=</span> <span class="n">_series</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">*=</span> <span class="n">_series</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">R</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">series</span>

    <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">_series</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">R</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
            <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">_series</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
            <span class="n">_series</span> <span class="o">=</span> <span class="n">_series</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
            <span class="n">series</span> <span class="o">+=</span> <span class="n">_series</span>
        <span class="k">return</span> <span class="n">series</span>

    <span class="k">elif</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
        <span class="n">R1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sring</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">R1</span><span class="p">)</span>
        <span class="n">series_inner</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="n">R</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">base</span><span class="p">),</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs_pow</span><span class="p">(</span><span class="n">series_inner</span><span class="p">,</span> <span class="n">expr</span><span class="o">.</span><span class="n">exp</span><span class="p">,</span> <span class="n">series_inner</span><span class="o">.</span><span class="n">ring</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">prec</span><span class="p">)</span>

    <span class="c1"># The `is_constant` method is buggy hence we check it at the end.</span>
    <span class="c1"># See issue #9786 for details.</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">Expr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expr</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">sring</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="k">def</span> <span class="nf">rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the series expansion of an expression about 0.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : :class:`Expr`</span>
<span class="sd">    a : :class:`Symbol` with respect to which expr is to be expanded</span>
<span class="sd">    prec : order of the series expansion</span>

<span class="sd">    Currently supports multivariate Taylor series expansion. This is much</span>
<span class="sd">    faster that Sympy&#39;s series method as it uses sparse polynomial operations.</span>

<span class="sd">    It automatically creates the simplest ring required to represent the series</span>
<span class="sd">    expansion through repeated calls to sring.</span>

<span class="sd">    Examples</span>
<span class="sd">    ========</span>

<span class="sd">    &gt;&gt;&gt; from sympy.polys.ring_series import rs_series</span>
<span class="sd">    &gt;&gt;&gt; from sympy.functions import sin, cos, exp, tan</span>
<span class="sd">    &gt;&gt;&gt; from sympy.core import symbols</span>
<span class="sd">    &gt;&gt;&gt; from sympy.polys.domains import QQ</span>
<span class="sd">    &gt;&gt;&gt; a, b, c = symbols(&#39;a, b, c&#39;)</span>
<span class="sd">    &gt;&gt;&gt; rs_series(sin(a) + exp(a), a, 5)</span>
<span class="sd">    1/24*a**4 + 1/2*a**2 + 2*a + 1</span>
<span class="sd">    &gt;&gt;&gt; series = rs_series(tan(a + b)*cos(a + c), a, 2)</span>
<span class="sd">    &gt;&gt;&gt; series.as_expr()</span>
<span class="sd">    -a*sin(c)*tan(b) + a*cos(c)*tan(b)**2 + a*cos(c) + cos(c)*tan(b)</span>
<span class="sd">    &gt;&gt;&gt; series = rs_series(exp(a**QQ(1,3) + a**QQ(2, 5)), a, 1)</span>
<span class="sd">    &gt;&gt;&gt; series.as_expr()</span>
<span class="sd">    a**(11/15) + a**(4/5)/2 + a**(2/5) + a**(2/3)/2 + a**(1/3) + 1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">series</span> <span class="o">=</span> <span class="n">sring</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">QQ</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">add_gens</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="p">])</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">ring</span>
    <span class="n">gen</span> <span class="o">=</span> <span class="n">R</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">prec_got</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">prec_got</span> <span class="o">&gt;=</span> <span class="n">prec</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># increase the requested number of terms to get the desired</span>
        <span class="c1"># number keep increasing (up to 9) until the received order</span>
        <span class="c1"># is different than the original order and then predict how</span>
        <span class="c1"># many additional terms are needed</span>
        <span class="k">for</span> <span class="n">more</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec</span> <span class="o">+</span> <span class="n">more</span><span class="p">)</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
            <span class="n">new_prec</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">new_prec</span> <span class="o">!=</span> <span class="n">prec_got</span><span class="p">:</span>
                <span class="n">prec_do</span> <span class="o">=</span> <span class="n">ceiling</span><span class="p">(</span><span class="n">prec</span> <span class="o">+</span> <span class="p">(</span><span class="n">prec</span> <span class="o">-</span> <span class="n">prec_got</span><span class="p">)</span><span class="o">*</span><span class="n">more</span><span class="o">/</span><span class="p">(</span><span class="n">new_prec</span> <span class="o">-</span>
                    <span class="n">prec_got</span><span class="p">))</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec_do</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">p1</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">gen</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">prec</span><span class="p">:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">_rs_series</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="n">prec_do</span><span class="p">)</span>
                    <span class="n">gen</span> <span class="o">=</span> <span class="n">gen</span><span class="o">.</span><span class="n">set_ring</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">ring</span><span class="p">)</span>
                    <span class="n">prec_do</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not calculate </span><span class="si">%s</span><span class="s1"> terms for </span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span> <span class="n">expr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rs_trunc</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">prec</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/sympylogo.png" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015 SymPy Development Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>